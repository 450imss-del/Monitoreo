<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Centro de Monitoreo S√≠smico</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

<style>
body{
  margin:0;
  background:#000;
  color:white;
  font-family: Arial, sans-serif;
  overflow:hidden;
}

/* Barra superior */
#statusBar{
  background:#0a0;
  padding:10px;
  font-size:22px;
  font-weight:bold;
  text-align:center;
}
.alerta{
  background:red !important;
}

/* Layout */
#container{
  display:grid;
  grid-template-columns: 70% 30%;
  height:calc(100vh - 60px);
}

/* Mapa */
#map{
  height:100%;
}

/* Panel lateral */
#panel{
  padding:10px;
  border-left:2px solid #333;
  font-size:16px;
}

/* Lista */
li{
  border-bottom:1px solid #333;
  padding:6px;
}

/* Reloj */
#clock{
  font-size:20px;
  text-align:center;
  margin-bottom:10px;
}

/* Ticker noticias */
#ticker{
  position:fixed;
  bottom:0;
  width:100%;
  background:black;
  color:#00ff00;
  font-size:20px;
  padding:5px 0;
  overflow:hidden;
  white-space:nowrap;
}
#tickerText{
  display:inline-block;
  padding-left:100%;
  animation: scroll 25s linear infinite;
}
@keyframes scroll{
  from{ transform:translateX(0%); }
  to{ transform:translateX(-100%); }
}

/* Bot√≥n simulacro */
#simBtn{
  position:fixed;
  bottom:50px;
  right:20px;
  background:red;
  color:white;
  border:none;
  padding:12px 18px;
  font-size:16px;
  border-radius:6px;
  cursor:pointer;
  z-index:9999;
}
#simBtn:hover{ background:darkred; }

/* Parpadeo alerta */
.flash{
  animation: flash 0.5s infinite alternate;
}
@keyframes flash{
  from{background:#000;}
  to{background:#400;}
}
</style>
</head>

<body>

<div id="statusBar">üü¢ ESTADO ACTUAL: SIN ALERTAS</div>

<div id="container">
  <div id="map"></div>
  <div id="panel">
    <div id="clock"></div>
    <h3>üìä Resumen Hoy</h3>
    <div id="summary">Cargando...</div>
    <h3>üìç √öltimos Sismos</h3>
    <ul id="quakeList"></ul>
  </div>
</div>

<div id="ticker">
  <span id="tickerText">Sistema de monitoreo s√≠smico en tiempo real - USGS</span>
</div>

<button id="simBtn" onclick="simulateQuake()">üö® SIMULAR SISMO</button>

<audio id="alarm" src="https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg"></audio>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<script>
// MAPA
const map = L.map('map').setView([19.4326, -99.1332], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let markers = [];

// RELOJ
setInterval(()=>{
  document.getElementById("clock").innerHTML = "üïí " + new Date().toLocaleString();
},1000);

// CARGAR SISMOS
async function loadQuakes(){
  const url = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson";
  const res = await fetch(url);
  const data = await res.json();

  markers.forEach(m=>map.removeLayer(m));
  markers = [];

  let maxMag = 0;
  let count = 0;
  let lastText = "";

  const list = document.getElementById("quakeList");
  list.innerHTML = "";

  data.features.forEach(q=>{
    const mag = q.properties.mag;
    const place = q.properties.place;
    const time = new Date(q.properties.time).toLocaleString("es-MX");
    const lat = q.geometry.coordinates[1];
    const lon = q.geometry.coordinates[0];

    if(place.includes("Mexico") || place.includes("M√©xico")){
      count++;
      if(mag > maxMag) maxMag = mag;
      lastText = `√öLTIMO SISMO: M${mag} en ${place} - ${time}`;

      let color = mag < 3 ? "green" : mag < 5 ? "yellow" : mag < 6 ? "orange" : "red";

      const marker = L.circleMarker([lat,lon],{
        radius:6,
        color:color,
        fillColor:color,
        fillOpacity:0.8
      }).addTo(map)
      .bindPopup(`M${mag} - ${place}`);

      markers.push(marker);

      const li = document.createElement("li");
      li.innerHTML = `M${mag} - ${place} <br><small>${time}</small>`;
      li.style.color = color;
      list.appendChild(li);

      // ALERTA AUTOM√ÅTICA
      if(mag >= 6){
        activateAlert(mag, place);
      }
    }
  });

  document.getElementById("summary").innerHTML =
    `üåé Sismos hoy: ${count}<br>‚ö†Ô∏è Mayor magnitud: ${maxMag}`;

  document.getElementById("tickerText").innerHTML = lastText || "Sin sismos recientes";
}

// ALERTA REAL
function activateAlert(mag, place){
  const status = document.getElementById("statusBar");
  status.classList.add("alerta");
  status.innerHTML = `üö® ALERTA S√çSMICA M${mag} - ${place}`;
  document.body.classList.add("flash");
  document.getElementById("alarm").play();
}

// SIMULACRO
function simulateQuake(){
  activateAlert(7.5, "SIMULADO CDMX");
  setTimeout(()=>{
    document.getElementById("statusBar").classList.remove("alerta");
    document.getElementById("statusBar").innerHTML="üü¢ ESTADO ACTUAL: SIN ALERTAS";
    document.body.classList.remove("flash");
  },10000);
}

// REFRESH CADA 1 MINUTO
loadQuakes();
setInterval(loadQuakes, 60000);
</script>

</body>
</html>
