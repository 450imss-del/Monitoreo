<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Alerta SÃ­smica MÃ©xico - Monitor en Tiempo Real</title>

<!-- ESTILOS -->
<style>
* {
    box-sizing: border-box;
    font-family: Arial, sans-serif;
}

body {
    margin: 0;
    padding: 0;
    background: #0f172a;
    color: #fff;
}

header {
    background: #111827;
    padding: 15px;
    text-align: center;
    font-size: 20px;
    font-weight: bold;
    border-bottom: 2px solid #22c55e;
}

.container {
    padding: 15px;
    max-width: 900px;
    margin: auto;
}

button {
    padding: 12px 18px;
    border: none;
    border-radius: 8px;
    background: #22c55e;
    color: black;
    font-weight: bold;
    cursor: pointer;
    font-size: 16px;
}

button:hover {
    background: #16a34a;
}

.status {
    margin-top: 10px;
    font-size: 14px;
    color: #9ca3af;
}

ul {
    list-style: none;
    padding: 0;
}

li {
    margin: 10px 0;
    padding: 12px;
    border-radius: 8px;
    background: #111827;
    border-left: 6px solid gray;
}

.light { border-left-color: #22c55e; }
.moderate { border-left-color: #f59e0b; }
.strong { border-left-color: #ef4444; }

footer {
    text-align: center;
    padding: 10px;
    font-size: 12px;
    color: #6b7280;
}
</style>
</head>

<body>

<header>ðŸŒŽ Alerta SÃ­smica MÃ©xico - Monitoreo en Tiempo Real</header>

<div class="container">

<button onclick="fetchEarthquakes()">ðŸ”„ Actualizar ahora</button>
<div class="status" id="status">Obteniendo ubicaciÃ³n...</div>

<ul id="earthquakeList"></ul>

</div>

<footer>
Datos: USGS | Proyecto educativo | No reemplaza sistemas oficiales (SASMEX)
</footer>

<script>
let userLocation = null;

// Obtener ubicaciÃ³n
function getUserLocation() {
    if (!navigator.geolocation) {
        document.getElementById("status").textContent = "âŒ GeolocalizaciÃ³n no soportada.";
        return;
    }

    navigator.geolocation.getCurrentPosition(pos => {
        userLocation = {
            lat: pos.coords.latitude,
            lon: pos.coords.longitude
        };
        document.getElementById("status").textContent = 
            `ðŸ“ UbicaciÃ³n detectada: ${userLocation.lat.toFixed(2)}, ${userLocation.lon.toFixed(2)}`;
        fetchEarthquakes();
    }, err => {
        document.getElementById("status").textContent = "âš ï¸ No se pudo obtener ubicaciÃ³n.";
    });
}

// Distancia Haversine
function distanceKm(lat1, lon1, lat2, lon2) {
    const R = 6371;
    const dLat = (lat2 - lat1) * Math.PI / 180;
    const dLon = (lon2 - lon1) * Math.PI / 180;
    const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
    return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
}

// Obtener sismos
async function fetchEarthquakes() {
    const url = "https://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/all_day.geojson";
    const list = document.getElementById("earthquakeList");
    list.innerHTML = "";

    try {
        const res = await fetch(url);
        const data = await res.json();

        if (!userLocation) {
            document.getElementById("status").textContent = "âš ï¸ Activa GPS.";
            return;
        }

        data.features.forEach(eq => {
            const mag = eq.properties.mag;
            const place = eq.properties.place;
            const lat = eq.geometry.coordinates[1];
            const lon = eq.geometry.coordinates[0];

            // Bounding box MÃ©xico
            if (lat < 14 || lat > 33 || lon < -118 || lon > -86) return;

            const dist = distanceKm(userLocation.lat, userLocation.lon, lat, lon);
            const time = new Date(eq.properties.time).toLocaleString("es-MX");

            const li = document.createElement("li");
            li.innerHTML = `
                <b>Magnitud:</b> ${mag} <br>
                <b>Zona:</b> ${place} <br>
                <b>Distancia:</b> ${dist.toFixed(1)} km <br>
                <b>Hora:</b> ${time}
            `;

            if (mag < 4) li.classList.add("light");
            else if (mag < 6) li.classList.add("moderate");
            else li.classList.add("strong");

            list.appendChild(li);
        });

    } catch (e) {
        document.getElementById("status").textContent = "âŒ Error cargando datos.";
        console.error(e);
    }
}

// Auto actualizaciÃ³n cada 60s
setInterval(fetchEarthquakes, 60000);

getUserLocation();
</script>

</body>
</html>
